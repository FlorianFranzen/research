
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Networking for Polkadot &#8212; Research at W3F</title>
    <link rel="stylesheet" href="../../_static/material.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/stylesheets/extra.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"extensions": ["tex2jax.js"], "jax": ["input/TeX", "output/HTML-CSS"], "tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "displayMath": [["$$", "$$"], ["\\[", "\\]"]], "processEscapes": true}, "HTML-CSS": {"fonts": ["TeX"]}})</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Gossiping GRANDPA communication (polite-grandpa)" href="2-polite-grandpa.html" />
    <link rel="prev" title="Networking" href="../networking.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=deep-orange data-md-color-accent=deep-orange>
  <svg class="md-svg">
    <defs data-children-count="0">
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448"
           id="__github">
        <path fill="currentColor"
              d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"></path>
      </svg>
    </defs>
  </svg>
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#polkadot/networking/1-overview" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../index.html" title="Research at W3F"
           class="md-header-nav__button md-logo">
          
              <img src="../../_static/w3f_logo.svg" height="26"
                   alt="Research at W3F logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Research at W3F</span>
          <span class="md-header-nav__topic"> Networking for Polkadot </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">Research at W3F</a></li>
          <li class="md-tabs__item"><a href="../../polkadot.html" class="md-tabs__link">Polkadot</a></li>
          <li class="md-tabs__item"><a href="../networking.html" class="md-tabs__link">Networking</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../index.html" title="Research at W3F" class="md-nav__button md-logo">
      
        <img src="../../_static/w3f_logo.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../index.html"
       title="Research at W3F">Research at W3F</a>
  </label>
  

  
  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <a href="../../polkadot.html" class="md-nav__link">Polkadot</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
      <a href="../index.html" class="md-nav__link">Polkadot</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../Availability_and_Validity.html" class="md-nav__link">Availability and Validity</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../GRANDPA.html" class="md-nav__link">GRANDPA</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../ICMP.html" class="md-nav__link">ICMP Scheme</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../Parachain-Allocation.html" class="md-nav__link">Parachain Allocation</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../Polkadot-Runtime-Environment.html" class="md-nav__link">Polkadot Runtime Environment Specification</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../Token Economics.html" class="md-nav__link">Token Economics</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../BABE.html" class="md-nav__link">BABE</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../NPoS.html" class="md-nav__link">NPoS</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../keys.html" class="md-nav__link">Keys</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../networking.html" class="md-nav__link">Networking</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Networking for Polkadot </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Networking for Polkadot</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#polkadot-networking-1-overview--page-root" class="md-nav__link">Networking for Polkadot</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#overview" class="md-nav__link">Overview</a>
        </li>
        <li class="md-nav__item"><a href="#message-types" class="md-nav__link">Message types</a>
        </li>
        <li class="md-nav__item"><a href="#message-keys-and-sizes" class="md-nav__link">Message keys and sizes</a>
        </li>
        <li class="md-nav__item"><a href="#peer-discovery" class="md-nav__link">Peer Discovery</a>
        </li>
        <li class="md-nav__item"><a href="#bounded-gossip-protocols" class="md-nav__link">Bounded Gossip Protocols</a>
        </li>
        <li class="md-nav__item"><a href="#main-subprotocols" class="md-nav__link">Main subprotocols</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../_sources/polkadot/networking/1-overview.md.txt">Show Source</a> </li>

  </ul>
</nav><ul class="md-nav__list"> 
    <li class="md-nav__item">
    
      <a href="#overview" class="md-nav__link">Overview</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="#message-types" class="md-nav__link">Message types</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="#message-keys-and-sizes" class="md-nav__link">Message keys and sizes</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="#peer-discovery" class="md-nav__link">Peer Discovery</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="#bounded-gossip-protocols" class="md-nav__link">Bounded Gossip Protocols</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="#main-subprotocols" class="md-nav__link">Main subprotocols</a>
      
    </li></ul>
    </li>
    <li class="md-nav__item">
    
      <a href="2-polite-grandpa.html" class="md-nav__link">Gossiping GRANDPA communication (polite-grandpa)</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="3-attestation.html" class="md-nav__link">Parachain networking</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="4-icmp.html" class="md-nav__link">ICMP</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="4-icmp.html#interchain-messaging-routing-overview" class="md-nav__link">Interchain Messaging Routing Overview</a>
      
    </li></ul>
    </li>
    <li class="md-nav__item">
    
      <a href="../slashing.html" class="md-nav__link">Slashing</a>
      
    </li></ul>
    </li>
    <li class="md-nav__item">
    
      <a href="../../research_team_members.html" class="md-nav__link">Research Team Members</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../news.html" class="md-nav__link">News</a>
      
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#polkadot-networking-1-overview--page-root" class="md-nav__link">Networking for Polkadot</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#overview" class="md-nav__link">Overview</a>
        </li>
        <li class="md-nav__item"><a href="#message-types" class="md-nav__link">Message types</a>
        </li>
        <li class="md-nav__item"><a href="#message-keys-and-sizes" class="md-nav__link">Message keys and sizes</a>
        </li>
        <li class="md-nav__item"><a href="#peer-discovery" class="md-nav__link">Peer Discovery</a>
        </li>
        <li class="md-nav__item"><a href="#bounded-gossip-protocols" class="md-nav__link">Bounded Gossip Protocols</a>
        </li>
        <li class="md-nav__item"><a href="#main-subprotocols" class="md-nav__link">Main subprotocols</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../_sources/polkadot/networking/1-overview.md.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <p>====================================================================</p>
<p><strong>Authors</strong>: Fatemeh Shirazi, Rob Habermeier, Ximin Luo</p>
<p><strong>Last updated</strong>: 24.09.2019</p>
<p><strong>Note</strong>: This write-up contains notes from a networking workshop 05.08.19-06.08.19 at Parity Technologies.</p>
<p>====================================================================</p>

<h1 id="polkadot-networking-1-overview--page-root">Networking for Polkadot<a class="headerlink" href="#polkadot-networking-1-overview--page-root" title="Permalink to this headline">¶</a></h1>

<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>In Polkadot we need to send a number of messages to a number of entities.
First let’s recap the different entity types:</p>
<ul class="simple">
<li><p>User - create and submit transactions to parachains or the relay chain.</p></li>
<li><p>Collator - these belong to a specific parachain. They collate parachain
  transactions into blocks, generate proofs-of-validity and propose them to
  parachain validators as candidates for the next block. The latter two tasks
  (relating to validity) are part of Polkadot’s rules, but how collation is
  done is chosen autonomously by the parachain.</p></li>
<li><p>Validator - these belong to the relay chain and follow Polkadot’s rules.
  Distinct subsets of validators are also assigned to specific parachains in
  order to validate those chains, and then we refer to them as a “parachain
  validator”. They also collate transactions submitted to the relay chain.</p></li>
</ul>
<p>Next, we have several subprotocols between these entities, each serving one
abstract part of the process of executing transactions:</p>
<ol class="simple">
<li><p>Transaction submission - users find the relevant entities to contact for
   submitting a transaction, and submit them if they are reachable.</p></li>
<li><p>Parachain collation - parachain collators collect transactions into blocks,
   the internals of which are outside the scope of Polkadot, chosen by each
   parachain for themselves.</p></li>
<li><p>Parachain block attestation: collators also generate additional proof-data
   and pass this to the parachain validators. The ultimate aim of this is for
   the parachain validators to efficiently check that every parachain block
   satisfies the parachain validation function. To generate the proof-data, the
   collators also need data from the relay chain, sent back by the parachain
   validators in an earlier stage of this process.</p></li>
<li><p>Relay-chain protocols: parachain validators attest to the validity of any
   parachain blocks they have been sent, and distribute these attestations to
   the other validators. Then all the validators collate attested blocks plus
   relay chain transactions into a relay chain block, and finalise the block.</p></li>
<li><p>Inter-chain messaging: after a relay chain block is finalised and this fact
   is communicated back to the parachains, they check if these blocks contain
   new messages from other parachains, and retrieve and react them if so.</p></li>
<li><p>Parachain synchronisation: when a collator becomes connected for the first
   time or after being disconnected for a long time, it must retrieve and
   validate the latest state of the parachain, including transactions submitted
   in the interim and information about the latest state of the relay chain.</p></li>
<li><p>Relay-chain synchronisation: when validator becomes connected for the first
   time or after being disconnected for a long time, it must retrieve and
   validate the latest state of the relay chain, including transactions
   submitted in the interim.</p></li>
</ol>
<p>Details have been abstracted away in the descriptions above, in an effort to
remain valid even if those details change. At the time of writing, subprotocols
(3-5) and 7 are, and are expected to remain, the largest and most complex
components that the Polkadot networking layer needs to be able to serve.</p>


<h2 id="message-types">Message types<a class="headerlink" href="#message-types" title="Permalink to this headline">¶</a></h2>
<p>Below we give a more precise and detailed overview of where and how each type
of message is sent, according to the subprotocol designs as of 2019 October:</p>
<p>TODO: convert the below into a nicer-looking table, needs conversion away from
markdown into something more powerful like reStructuredText.</p>
<p>Key for notation:</p>
<table>
<thead>
<tr class="row-odd"><th class="head">symbol</th>
<th class="head">meaning</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td>--&gt;</td>
<td>send, to specific recipient(s)</td>
</tr>
<tr class="row-odd"><td>-&gt;&gt;</td>
<td>send, to non-specific recipients</td>
</tr>
<tr class="row-even"><td>&gt;&gt;&gt;</td>
<td>gossip, to everyone eventually</td>
</tr>
<tr class="row-odd"><td>S:</td>
<td>sender is the source of the message (this includes new messages derived from other data)</td>
</tr>
<tr class="row-even"><td>F:</td>
<td>sender is forwarding the message, received from someone else</td>
</tr>
</tbody>
</table>
<ul>
<li><p>From users / light clients (subprotocol 1):</p>
<ul>
<li>Users -&gt;&gt; Collator:<ul class="simple">
<li><p>S  : P-transactions</p></li>
</ul>
</li>
<li>Users -&gt;&gt; Validators:<ul class="simple">
<li><p>S  : R-transactions</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Within a parachain (subprotocol 2):</p>
<ul>
<li>Collators &gt;&gt;&gt; Collators:<ul class="simple">
<li><p>F  : R-blocks</p></li>
<li><p>F  : P-transactions</p></li>
<li><p>SF : P-blocks</p></li>
<li><p>SF : P-block-PoV</p></li>
</ul>
</li>
<li><p>note: gossip protocol details chosen by the parachain, not polkadot</p></li>
</ul>
</li>
<li><p>Relay chain &lt;-&gt; parachain (subprotocol 3)</p>
<ul>
<li>PValidators -&gt;&gt; Collator:<ul class="simple">
<li><p>F  : R-blocks</p></li>
</ul>
</li>
<li>PValidators --&gt; Validators:<ul class="simple">
<li><p>S  : PoV block, erasure coded pieces</p></li>
</ul>
</li>
<li>Collator -&gt;&gt; PValidators:<ul class="simple">
<li><p>SF : P-blocks</p></li>
<li><p>SF : P-block-PoV</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Within the relay chain (subprotocol 3)</p>
<ul>
<li>Validators &gt;&gt;&gt; Validators:<ul class="simple">
<li><p>F  : R-transactions</p></li>
<li><p>SF : P-block-PoV-attestation-and-other-metadata (“candidate receipt”)</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Within the relay chain (subprotocol 4)</p>
<ul>
<li>Validators &gt;&gt;&gt; Validators:<ul class="simple">
<li><p>SF : R-blocks</p></li>
<li><p>SF : GRANDPA votes</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Between different parachains (subprotocol 5)</p>
<ul>
<li>PValidator-1 -&gt;&gt; Collator-2:<ul class="simple">
<li><p>F  : ICMP messages</p></li>
</ul>
</li>
<li>Collator-1 -&gt;&gt; Collator-2:<ul class="simple">
<li><p>S  : ICMP messages</p></li>
</ul>
</li>
</ul>
</li>
</ul>


<h2 id="message-keys-and-sizes">Message keys and sizes<a class="headerlink" href="#message-keys-and-sizes" title="Permalink to this headline">¶</a></h2>
<p>The following message types are expected to be arbitrarily-large in size and
not suitable to be sent directly in a single transmission:</p>
<ul class="simple">
<li><p>P-block? (~1 MB)</p></li>
<li><p>P-block-PoV (~10 MB)</p></li>
<li><p>R-block (~1 MB)</p></li>
</ul>
<p>All other message types are expected to be fairly small (&lt;10 KB) and are
suitable to be sent in a single transmission (even if the physical network
performs fragmentation).</p>
<p>It may be beneficial to break these messages types up into chunks, or at the
very least they must be sent down a different stream so that they do not block
smaller message types, which tend to be more urgent.</p>
<p>The following message types are expected to contain an arbitrary number of
members and not be keyable to an indexable structure (e.g. blocks in a chain
can be keyed by height, pieces of an erasure coding can be keyed by x-coord):</p>
<ul class="simple">
<li><p>P-transactions</p></li>
<li><p>R-transactions</p></li>
<li><p>ICMP messages</p></li>
</ul>
<p>In order to deduplicate them while gossiping, a more formal or rigorous
set-reconciliation protocol will be needed, perhaps involving bloom filters.</p>
<p>TODO: consider the above issues and propose something concrete</p>


<h2 id="peer-discovery">Peer Discovery<a class="headerlink" href="#peer-discovery" title="Permalink to this headline">¶</a></h2>
<p>TODO: entities from different sources/groups (e.g. parachain vs relay chain)
might need their own prefixes in the DHT.</p>


<h2 id="bounded-gossip-protocols">Bounded Gossip Protocols<a class="headerlink" href="#bounded-gossip-protocols" title="Permalink to this headline">¶</a></h2>
<p>We treat the goals of our networking protocols as black-boxes. While gossip may not be the most efficient way to implement many of them, it will fulfill the black-box functionality.</p>
<p>In some cases, we will be able to gossip only among a known set of nodes, e.g., validators.
In the case that we are not, the design of the gossip protocol will differ from a classical gossip protocol substantially.
For these cases, we introduce the notion of a <em>bounded</em> gossip protocol.</p>
<p>We have the following requirements for nodes:</p>
<ol class="simple">
<li><p>Nodes never have to consider an unbounded number of gossip messages. The gossip messages they are willing to consider should be determined by some state sent to peers.</p></li>
<li><p>The work a node has to do to figure out if one of its peers will accept a message should be relatively small</p></li>
</ol>
<p>A bounded gossip system is one where nodes have a filtration mechanism for incoming packets that can be communicated to peers.</p>
<p>Nodes maintain a “propagation pool” of messages. When a node would like to circulate a message, it puts it into the pool until marked as expired. Every message is associated with a <em>topic</em>. Topics are used to group messages or encode metadata about them. They are not sent over the wire, but are rather determined by the contents of the message.</p>
<p>We define a node’s peer as any other node directly connected by an edge in the gossip graph, i.e. a node with which the node has a direct connection. The node’s peers may vary over time.</p>
<p>For every peer <span class="math notranslate nohighlight">\(k\)</span>, the node maintains a <em>filtration criterion</em><span class="math notranslate nohighlight">\(allowed_k(m) \rightarrow bool\)</span></p>
<p>Whenever a new peer <span class="math notranslate nohighlight">\(k\)</span> connects, all messages from the pool (filtered according to <span class="math notranslate nohighlight">\(allowed_k\)</span> ) are sent to that peer.</p>
<p>Whenever a peer places a new message <span class="math notranslate nohighlight">\(m\)</span> in its propagation pool, it sends this message to all peers <span class="math notranslate nohighlight">\(k\)</span> where <span class="math notranslate nohighlight">\(allowed_k(m) \rightarrow true\)</span>.</p>
<p>Nodes can additionally issue a command <span class="math notranslate nohighlight">\(propagateTopic(k,t)\)</span> to propagate all messages with topic <span class="math notranslate nohighlight">\(t\)</span> to <span class="math notranslate nohighlight">\(k\)</span> which pass <span class="math notranslate nohighlight">\(allowed_k\)</span>.</p>
<p>Multiple bounded-gossip protocols can be safely joined by a short-circuiting binary OR over each of the <span class="math notranslate nohighlight">\(allowed_k\)</span> functions, provided that they do not overlap in the topics that they claim.</p>
<p>Note that while we cannot stop peers from sending us disallowed messages, such behavior can be detected, considered impolite, and will lead to eventual disconnection from the peer.</p>


<h2 id="main-subprotocols">Main subprotocols<a class="headerlink" href="#main-subprotocols" title="Permalink to this headline">¶</a></h2>
<p>The are three main networking protocols we require for Polkadot as follows:</p>
<p>i) GRANDPA gossiping</p>
<p>ii) Parachain networking, which includes: gossiping parachain blocks (attestation gossip) and sending/ receiving erasure coded pieces</p>
<p>iii) Interchain message-passing</p>
<p>Next, the schemes will be described in detail.</p>




          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="../networking.html" title="Material"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Networking </span>
              </div>
            </a>
          
          
            <a href="2-polite-grandpa.html" title="Admonition"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Gossiping GRANDPA communication (polite-grandpa) </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
            Created using
            <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
        <div class="md-footer-social">
          <link rel="stylesheet" href="../../_static/fonts/font-awesome.css">
            <a href="https://github.com/w3f/research" class="md-footer-social__link fa fa-github"></a>
            <a href="https://twitter.com/web3foundation" class="md-footer-social__link fa fa-twitter"></a>
            <a href="https://medium.com/web3foundation" class="md-footer-social__link fa fa-medium"></a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>