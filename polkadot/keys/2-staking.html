
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Nomination &#8212; Research at W3F</title>
    <link rel="stylesheet" href="../../_static/material.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/stylesheets/extra.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"extensions": ["tex2jax.js"], "jax": ["input/TeX", "output/HTML-CSS"], "tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "displayMath": [["$$", "$$"], ["\\[", "\\]"]], "processEscapes": true}, "HTML-CSS": {"fonts": ["TeX"]}})</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Session keys" href="3-session.html" />
    <link rel="prev" title="Account signatures and keys in Polkadot" href="1-accounts-more.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=deep-orange data-md-color-accent=deep-orange>
  <svg class="md-svg">
    <defs data-children-count="0">
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448"
           id="__github">
        <path fill="currentColor"
              d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"></path>
      </svg>
    </defs>
  </svg>
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#polkadot/keys/2-staking" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../index.html" title="Research at W3F"
           class="md-header-nav__button md-logo">
          
              <img src="../../_static/w3f_logo.svg" height="26"
                   alt="Research at W3F logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Research at W3F</span>
          <span class="md-header-nav__topic"> Nomination </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">Research at W3F</a></li>
          <li class="md-tabs__item"><a href="../../polkadot.html" class="md-tabs__link">Polkadot</a></li>
          <li class="md-tabs__item"><a href="../keys.html" class="md-tabs__link">Keys</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../index.html" title="Research at W3F" class="md-nav__button md-logo">
      
        <img src="../../_static/w3f_logo.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../index.html"
       title="Research at W3F">Research at W3F</a>
  </label>
  

  
  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <a href="../../polkadot.html" class="md-nav__link">Polkadot</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
      <a href="../index.html" class="md-nav__link">Polkadot</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../Availability_and_Validity.html" class="md-nav__link">Availability and Validity</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../GRANDPA.html" class="md-nav__link">GRANDPA</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../ICMP.html" class="md-nav__link">ICMP Scheme</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../Parachain-Allocation.html" class="md-nav__link">Parachain Allocation</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../Polkadot-Runtime-Environment.html" class="md-nav__link">Polkadot Runtime Environment Specification</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../Token Economics.html" class="md-nav__link">Token Economics</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../BABE.html" class="md-nav__link">BABE</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../NPoS.html" class="md-nav__link">NPoS</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../keys.html" class="md-nav__link">Keys</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
      <a href="index.html" class="md-nav__link">Polkadot’s cryptography</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="1-accounts.html" class="md-nav__link">Account signatures and keys</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="1-accounts-more.html" class="md-nav__link">Account signatures and keys in Polkadot</a>
      
    </li>
    <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Nomination </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Nomination</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#polkadot-keys-2-staking--page-root" class="md-nav__link">Nomination</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#stash-account-keys" class="md-nav__link">Stash account keys</a>
        </li>
        <li class="md-nav__item"><a href="#stake-controller-account-keys" class="md-nav__link">Stake controller account keys</a>
        </li>
        <li class="md-nav__item"><a href="#certificate-location" class="md-nav__link">Certificate location</a>
        </li>
        <li class="md-nav__item"><a href="#certificate-size" class="md-nav__link">Certificate size</a>
        </li>
        <li class="md-nav__item"><a href="#implementation" class="md-nav__link">Implementation</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../_sources/polkadot/keys/2-staking.md.txt">Show Source</a> </li>

  </ul>
</nav><ul class="md-nav__list"> 
    <li class="md-nav__item">
    
      <a href="#stash-account-keys" class="md-nav__link">Stash account keys</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="#stake-controller-account-keys" class="md-nav__link">Stake controller account keys</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="#certificate-location" class="md-nav__link">Certificate location</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="#certificate-size" class="md-nav__link">Certificate size</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="#implementation" class="md-nav__link">Implementation</a>
      
    </li></ul>
    </li>
    <li class="md-nav__item">
    
      <a href="3-session.html" class="md-nav__link">Session keys</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="4-secio.html" class="md-nav__link">Transport layer authentication - libp2p’s SECIO</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="creation.html" class="md-nav__link">Account key creation ideas for Polkadot</a>
      
    </li></ul>
    </li>
    <li class="md-nav__item">
    
      <a href="../networking.html" class="md-nav__link">Networking</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../slashing.html" class="md-nav__link">Slashing</a>
      
    </li></ul>
    </li>
    <li class="md-nav__item">
    
      <a href="../../research_team_members.html" class="md-nav__link">Research Team Members</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../news.html" class="md-nav__link">News</a>
      
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#polkadot-keys-2-staking--page-root" class="md-nav__link">Nomination</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#stash-account-keys" class="md-nav__link">Stash account keys</a>
        </li>
        <li class="md-nav__item"><a href="#stake-controller-account-keys" class="md-nav__link">Stake controller account keys</a>
        </li>
        <li class="md-nav__item"><a href="#certificate-location" class="md-nav__link">Certificate location</a>
        </li>
        <li class="md-nav__item"><a href="#certificate-size" class="md-nav__link">Certificate size</a>
        </li>
        <li class="md-nav__item"><a href="#implementation" class="md-nav__link">Implementation</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../_sources/polkadot/keys/2-staking.md.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="polkadot-keys-2-staking--page-root">Nomination<a class="headerlink" href="#polkadot-keys-2-staking--page-root" title="Permalink to this headline">¶</a></h1>
<p>In some sense, all public keys derive their authority from some combination of ceremonies and certificates, with certificate root keys deriving their authority entirely from ceremonies.  As an example, trust-on-first-use schemes might be considered a pair of cerimonies, the key being associated to an identity first, and the threat of other comparing keys fingerprints.</p>
<p>We apply this perspective to a consensus algorithm for a proof-of-stake blockchains like polkadot by regarding the chain itself as one large ceremony and treating the staked/bonded account as the root of trust.  We then have certificates issued by these staked account keys that authenticate both the session keys used by Polkadot validators and block producers, as well as the long-term transport layer authentication keys required by TLS or Noise (see concerns about libp2p’s secio).  </p>

<h2 id="stash-account-keys">Stash account keys<a class="headerlink" href="#stash-account-keys" title="Permalink to this headline">¶</a></h2>
<p>In polkadot, these staked or bonded account keys are called “stash account keys” to help disambiguate them from other key roles discussed below.  We currently describe <code class="docutils literal notranslate"><span class="pre">unbond</span></code>, <code class="docutils literal notranslate"><span class="pre">withdraw_unbonded</span></code>, and <code class="docutils literal notranslate"><span class="pre">bond_extra</span></code> transactions in [2].  There are several ways to implement these, or related operations, but if accounts are not too constrained in size then one extremely flexible approach goes:</p>
<p>These stash accounts has an unstaked balance <span class="math notranslate nohighlight">\(u \ge 0\)</span> and a list of pending unstaking dates and balances <span class="math notranslate nohighlight">\(T = \{ (t,v) \}\)</span> with <span class="math notranslate nohighlight">\(v&gt;0\)</span>, one of which lack any unstaking date, meaning <span class="math notranslate nohighlight">\(t = \infty\)</span>.  An unstaking operation splits <span class="math notranslate nohighlight">\((\infini,v) \in T\)</span> into $<span class="math notranslate nohighlight">\((\infini,v - v')\)</span> and <span class="math notranslate nohighlight">\((t,v')\)</span>.  Any payment out of a staked account completes any pending unstaking operations by moving their value into the unstaked balance <span class="math notranslate nohighlight">\(u\)</span>.  In other words, at block height <span class="math notranslate nohighlight">\(h\)</span>, a payment of value <span class="math notranslate nohighlight">\(v'\)</span> with fees <span class="math notranslate nohighlight">\(f\)</span> out of a stash account is valid if</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(T_1 = \{ (t,v) \in T_0 : t &gt; h \}\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(u_1 := u_0 + \sum \{ (t,v) \in T_0 : t \le h \} - h - f\)</span> remains positive.</p></li>
</ul>
<p>We might require additional metadata in <span class="math notranslate nohighlight">\(T\)</span> so that delayed slashing cannot impact more recently added stake, but this resembles the above discussion.  TODO:  Be more detailed?</p>


<h2 id="stake-controller-account-keys">Stake controller account keys<a class="headerlink" href="#stake-controller-account-keys" title="Permalink to this headline">¶</a></h2>
<p>We must support, or may even require, that these session keys and TLS keys rotate periodically.  At the same time, we must support stash account keys being air gapped, which prevents them from signing anything regularly.  In consequence, we require another layer, called “stake controller account keys”, that lies strictly between, and control the nomination of or delegation from stash account keys to session keys. </p>
<p>As we require small transactions associated to staking, these “stake controller account keys” are actual account keys with their own separate balance, usually much smaller than the “stash account key” for which they manage nomination/delegation. </p>
<p>In future, we might permit the certificate from the stash account key to limit the actions of a controller keys, which improves our stakers’ security when certain functions permit less slashing.  In particular, we might admit modes for fishermen and block producers that prohibit nominating or running a validator.  </p>
<p>At the moment however, we only support one such slashing level, so all mode transitions are functions of the controller key itself, as described in [2].</p>


<h2 id="certificate-location">Certificate location<a class="headerlink" href="#certificate-location" title="Permalink to this headline">¶</a></h2>
<p>We could either store certificates with account data, or else provide certificates in protocol interactions, but almost surely the certificate delegating from the staked account to the nominator key belongs in the account data.</p>
<p>We should take care with the certificates from the controller key to the session key because the session key requires a proof-of-possesion.  If we place them into the controller account, then there is a temptation to trust them and not check the proof-of-possesion ourselves.  We cannot necessarily trust the chain for proofs-of-possesion because doing so might provides escalation for attackers who succeed in posting any invalid data.  If we provide them in interactions then there is a temptation to check the proof-of-possesion repeatedly.  We should evaluate either attaching a self-checked flag to the staked account database vs storing session keys in some self-checked account database separate from the account database for which nodes trust the chain.  </p>


<h2 id="certificate-size">Certificate size<a class="headerlink" href="#certificate-size" title="Permalink to this headline">¶</a></h2>
<p>We could save some space by using implicit certificates to issue nominator keys, but we consider our initial implementation in <a class="reference external" href="https://github.com/w3f/schnorr-dalek/blob/master/src/cert.rs#L181"><code class="docutils literal notranslate"><span class="pre">schnorr-dalek/src/cert.rs</span></code></a> insufficient, so we’d require another implicit certificate scheme for this.  In essence, an accounts nominator key could be defined by an additional 32 bytes attached to the account, along with any associated data.  Actually doing this requires understanding (a) what form this associated data should take, and (b) if the space savings are worth the complexity of an implicit certificates scheme, mostly <a class="reference external" href="https://github.com/w3f/schnorr-dalek/issues/4">reviewing the literature</a>.  We favor simplicity by avoiding implicit certificates currently.</p>


<h2 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>[1] https://github.com/paritytech/substrate/pull/1782#discussion_r260265815
[2] https://github.com/paritytech/substrate/blob/1a2ec9eec1fe9b3cc2677bac629fd7e9b0f6cf8e/srml/staking/Staking.md aka https://github.com/paritytech/substrate/commit/1a2ec9eec1fe9b3cc2677bac629fd7e9b0f6cf8e</p>




          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="1-accounts-more.html" title="Material"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Account signatures and keys in Polkadot </span>
              </div>
            </a>
          
          
            <a href="3-session.html" title="Admonition"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Session keys </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
            Created using
            <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
        <div class="md-footer-social">
          <link rel="stylesheet" href="../../_static/fonts/font-awesome.css">
            <a href="https://github.com/w3f/research" class="md-footer-social__link fa fa-github"></a>
            <a href="https://twitter.com/web3foundation" class="md-footer-social__link fa fa-twitter"></a>
            <a href="https://medium.com/web3foundation" class="md-footer-social__link fa fa-medium"></a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>