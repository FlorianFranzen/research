
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Polkadot’s cryptography &#8212; Research at W3F</title>
    <link rel="stylesheet" href="../../_static/material.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/stylesheets/extra.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"extensions": ["tex2jax.js"], "jax": ["input/TeX", "output/HTML-CSS"], "tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "displayMath": [["$$", "$$"], ["\\[", "\\]"]], "processEscapes": true}, "HTML-CSS": {"fonts": ["TeX"]}})</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Account signatures and keys" href="1-accounts.html" />
    <link rel="prev" title="Keys" href="../keys.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=deep-orange data-md-color-accent=deep-orange>
  <svg class="md-svg">
    <defs data-children-count="0">
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448"
           id="__github">
        <path fill="currentColor"
              d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"></path>
      </svg>
    </defs>
  </svg>
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#polkadot/keys/index" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../index.html" title="Research at W3F"
           class="md-header-nav__button md-logo">
          
              <img src="../../_static/w3f_logo.svg" height="26"
                   alt="Research at W3F logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Research at W3F</span>
          <span class="md-header-nav__topic"> Polkadot’s cryptography </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">Research at W3F</a></li>
          <li class="md-tabs__item"><a href="../../polkadot.html" class="md-tabs__link">Polkadot</a></li>
          <li class="md-tabs__item"><a href="../keys.html" class="md-tabs__link">Keys</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../index.html" title="Research at W3F" class="md-nav__button md-logo">
      
        <img src="../../_static/w3f_logo.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../index.html"
       title="Research at W3F">Research at W3F</a>
  </label>
  

  
  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <a href="../../polkadot.html" class="md-nav__link">Polkadot</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
      <a href="../index.html" class="md-nav__link">Polkadot</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../Availability_and_Validity.html" class="md-nav__link">Availability and Validity</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../GRANDPA.html" class="md-nav__link">GRANDPA</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../ICMP.html" class="md-nav__link">ICMP Scheme</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../Parachain-Allocation.html" class="md-nav__link">Parachain Allocation</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../Polkadot-Runtime-Environment.html" class="md-nav__link">Polkadot Runtime Environment Specification</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../Token Economics.html" class="md-nav__link">Token Economics</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../BABE.html" class="md-nav__link">BABE</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../NPoS.html" class="md-nav__link">NPoS</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../keys.html" class="md-nav__link">Keys</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Polkadot’s cryptography </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Polkadot’s cryptography</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#polkadot-keys-index--page-root" class="md-nav__link">Polkadot’s cryptography</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#account-keys" class="md-nav__link">Account keys</a>
        </li>
        <li class="md-nav__item"><a href="#session-keys" class="md-nav__link">Session keys</a>
        </li>
        <li class="md-nav__item"><a href="#old" class="md-nav__link">old</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../_sources/polkadot/keys/index.md.txt">Show Source</a> </li>

  </ul>
</nav><ul class="md-nav__list"> 
    <li class="md-nav__item">
    
      <a href="#account-keys" class="md-nav__link">Account keys</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="#session-keys" class="md-nav__link">Session keys</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="#old" class="md-nav__link">old</a>
      
    </li></ul>
    </li>
    <li class="md-nav__item">
    
      <a href="1-accounts.html" class="md-nav__link">Account signatures and keys</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="1-accounts-more.html" class="md-nav__link">Account signatures and keys in Polkadot</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="2-staking.html" class="md-nav__link">Nomination</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="3-session.html" class="md-nav__link">Session keys</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="4-secio.html" class="md-nav__link">Transport layer authentication - libp2p’s SECIO</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="creation.html" class="md-nav__link">Account key creation ideas for Polkadot</a>
      
    </li></ul>
    </li>
    <li class="md-nav__item">
    
      <a href="../networking.html" class="md-nav__link">Networking</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../slashing.html" class="md-nav__link">Slashing</a>
      
    </li></ul>
    </li>
    <li class="md-nav__item">
    
      <a href="../../research_team_members.html" class="md-nav__link">Research Team Members</a>
      
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#polkadot-keys-index--page-root" class="md-nav__link">Polkadot’s cryptography</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#account-keys" class="md-nav__link">Account keys</a>
        </li>
        <li class="md-nav__item"><a href="#session-keys" class="md-nav__link">Session keys</a>
        </li>
        <li class="md-nav__item"><a href="#old" class="md-nav__link">old</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../_sources/polkadot/keys/index.md.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="polkadot-keys-index--page-root">Polkadot’s cryptography<a class="headerlink" href="#polkadot-keys-index--page-root" title="Permalink to this headline">¶</a></h1>
<p>In polkadot, we necessarily distinguish among different permissions and functionalities with different keys and key types, respectively.  We roughly categories these into account keys with which users interact and session keys that nodes manage without operator intervention beyond the certification process.</p>

<h2 id="account-keys">Account keys<a class="headerlink" href="#account-keys" title="Permalink to this headline">¶</a></h2>
<p>Account keys have an associated balance of which portions can be <em>locked</em> to play roles in staking, resource rental, and governance, including waiting out some unlocking period.  We allow several locks of varying durations, both because these roles impose different restrictions, and for multiple unlocking periods running concurrently. </p>
<p>We encourage active participation in all these roles, but they all require occasional signatures from accounts.  At the same time, account keys have better physical security when kept in inconvenient locations, like safety deposit boxes, which makes signing arduous.  We avoid this friction for users as follows.</p>
<p>Accounts declare themselves to be <em>stash accounts</em> when locking funds for staking.  All stash accounts register a certificate on-chain that delegates all validator operation and nomination powers to some <em>controller account</em>, and also designates some <em>proxy key</em> for governance votes.  In this state, the controller and proxy accounts can sign for the stash account in staking and governance functions, respectively, but not transfer fund.  </p>
<p>As a result, the stash account’s locked funds can benefit from maximum physical security, while still actively participating via signatures from their controller or proxy account keys.  At anytime the stash account can replace its controller or proxy account keys, such as if operational security mistakes might’ve compromised either.</p>
<p>At present, we suport both ed25519 and schnorrkel/sr25519 for account keys.  These are both Schnorr-like signatures implemented using the Ed25519 curve, so both offer extremely similar security.  We recommend ed25519 keys for users who require HSM support or other external key management solution, while schnorrkel/sr25519 provides more blockchain-friendly functionality like HDKD and multi-signatures.  </p>
<p>In particular, schnorrkel/sr25519 uses the <a class="reference external" href="https://doc.dalek.rs/curve25519_dalek/ristretto/index.html">Ristretto</a> implementation of section 7 of Mike Hamburg’s <a class="reference external" href="https://eprint.iacr.org/2015/673.pdf">Decaf</a> paper, which provide the 2-torsion free points of the Ed25519 curve as a prime order group.  Avoiding the cofactor like this means Ristretto makes implementing more complex protocols significantly safer.  We employ Blake2b for most conventional hashing in polkadot, but schnorrkel/sr25519 itself uses the <a class="reference external" href="https://doc.dalek.rs/merlin/index.html">merlin</a> limited implementation of Mike Hamberg’s <a class="reference external" href="http://strobe.sourceforge.io/">STROBE</a>, which is based on Keccak-f(1600) and provides a hashing interface well suited to signatures and NIZKs.  See https://github.com/w3f/schnorrkel/blob/master/annoucement.md for more detailed design notes.</p>


<h2 id="session-keys">Session keys<a class="headerlink" href="#session-keys" title="Permalink to this headline">¶</a></h2>
<p>Session keys each fill roughly one particular role in consensus or security.  All session keys gain their authority from a session certificate that is signed by some controller key and that delegates appropriate stake.  </p>
<p>At any time, the controller key can pause or revoke this session certificate and/or issue replacement with new session keys.  All new session keys can be registered in advance, and some must be, so validators can cleanly transition to new hardware by issuing session certificates that only become valid after some future session.  We suggest using pause for emergency maintenance and using revocation if a session key might be compromised.  </p>
<p>We suggest session keys remain tied to one physical machine, so validator operators issue the session certificate using the RPC protocol, not handle the session secret keys themselves.   In particular, we caution against duplicating session secret keys across machines because such “high availability” designs invariably gets validator operators slashed.  Anytime new validator hardware must be started quickly the operator should first start the new node, and then certify the new session keys it creates using the RPC protocol.  </p>
<p>We impose no prior restrictions on the cryptography employed by specific substrate modules or associated session keys types.  </p>
<p>In BABE, validators use schnorrkel/sr25519 keys both for a verifiable random function (VRF) based on on <a class="reference external" href="https://eprint.iacr.org/2017/099.pdf">NSEC5</a>, as well as for regular Schnorr signatures.</p>
<p>A VRF is the public-key analog of a pseudo-random function (PRF), aka cryptographic hash function with a distinguished key, such as many MACs.  We award block productions slots when the block producer scores a low enough VRF output <span class="math notranslate nohighlight">\(\mathtt{VRF}(r_e || \mathtt{slot_number} )\)</span>, so anyone with the VRF public keys can verify that blocks were produced in the correct slot, but only the block producers know their slots in advance via their VRF secret key.</p>
<p>As in <a class="reference external" href="https://eprint.iacr.org/2017/573.pdf">Ouroboros Praos</a>, we provide a source of randomness <span class="math notranslate nohighlight">\(r_e\)</span> for the VRF inputs by hashing together all VRF outputs form the previous session, which requires that BABE keys be registered at least one full session before being used.</p>
<p>We reduce VRF output malleability by hashing the signer’s public key along side the input, which dramatically improves security when used with HDKD.  We also hash the VRF input and output together when providing output used elsewhere, which improves compossibility in security proofs. See the 2Hash-DH construction from Theorem 2 on page 32 in appendix C of <a class="reference external" href="https://eprint.iacr.org/2017/573.pdf">“Ouroboros Praos: An adaptively-secure, semi-synchronous proof-of-stake blockchain”</a>.  </p>
<p>In GRANDPA, validators shall vote using BLS signatures, which supports convenient signature aggregation and select ZCash’s BLS12-381 curve for performance.  There is a risk that BLS12-381 might drops significantly below 128 bits of security, due to number field sieve advancements.  If and when this happens, we expect upgrading GRANDPA to another curve to be straightforward.  See also https://mailarchive.ietf.org/arch/msg/cfrg/eAn3_8XpcG4R2VFhDtE_pomPo2Q</p>
<p>TODO: ImOnline ..  ref. https://github.com/paritytech/substrate/issues/3546 etc.</p>
<p>We treat libp2p’s transport keys roughly like session keys too, but they include the transport keys for sentry nodes, not just for the validator itself.  As such, the operator interacts slightly more with these.</p>


<h2 id="old">old<a class="headerlink" href="#old" title="Permalink to this headline">¶</a></h2>
<p>In this post, we shall first give a high level view of the various signing keys planned for use in Polkadot.  We then turn the discussion towards the certificate chain that stretches between staked account keys and the session keys used for our proof-of-stake design.  In other words, we aim to lay out the important questions on the “glue” between keys rolls here, but first this requires introducing the full spectrum of key rolls.</p>
<p>We have roughly four cryptographic layers in Polkadot:</p>
<ul class="simple">
<li><p><a class="reference external" href="1-accounts.html"><em>Account keys</em></a> are owned by users and tied to one actual dot denominated account on Polkadot.  Accounts could be staked/bonded, unstaked/unbonded, or unstaking/unbonding, but only an unstaked/unbonded account key can transfer dots from one account to another.  (<a class="reference external" href="1-accounts-more.html">more</a>)</p></li>
<li><p><a class="reference external" href="2-staking.html"><em>Nomination</em></a> provide a certificate chain between staked/bonded account keys and the session keys used by nodes in block production or validating.  As nominator keys cannot transfer dots, they insulate account keys, which may remain air gapped, from nodes actually running on the internet.</p></li>
<li><p><a class="reference external" href="3-session.html"><em>Session keys</em></a> are actually several keys kept together that provide the various signing functions required by validators, including a couple types of verifiable random function (VRF) keys.</p></li>
<li><p><a class="reference external" href="https://forum.web3.foundation/t/transport-layer-authentication-libp2ps-secio/69"><em>Transport layer static keys</em></a> are used by libp2p to authenticate connections between nodes.  We shall either certify these with the session key or perhaps include them directly in the session key.</p></li>
</ul>




          </article>
        </div>
      </div>
    </main>
    <footer class="md-footer">
      <div class="md-footer-nav">
        <nav class="md-footer-nav__inner md-grid">
            
              <a href="../keys.html" title="Material"
                 class="md-flex md-footer-nav__link md-footer-nav__link--prev"
                 rel="prev">
                <div class="md-flex__cell md-flex__cell--shrink">
                  <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
                </div>
                <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                  <span class="md-flex__ellipsis">
                    <span
                        class="md-footer-nav__direction"> Previous </span> Keys </span>
                </div>
              </a>
            
            
              <a href="1-accounts.html" title="Admonition"
                 class="md-flex md-footer-nav__link md-footer-nav__link--next"
                 rel="next">
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                  class="md-flex__ellipsis"> <span
                  class="md-footer-nav__direction"> Next </span> Account signatures and keys </span>
              </div>
              <div class="md-flex__cell md-flex__cell--shrink"><i
                  class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
              </div>
            
          </a>
          
        </nav>
      </div>
      <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">
          <div class="md-footer-copyright">
              <div class="md-footer-copyright__highlight">
                &#169; Copyright 2019, Web3 Foundation.
                
            </div>
              Created using
                <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
               and
              <a href="https://github.com/bashtage/sphinx-material/">Material for
                Sphinx</a></div>
        </div>
      </div>
    </footer>
      <script src="../../_static/javascripts/application.js"></script>
      <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </div>
  </body>
</html>